# Handoff — 플러그인 캐시 우회책 최종 정리

> 날짜: 2026-02-25
> 세션 ID: d1bbc9cb-8df3-4049-b73b-d7498c062a9e
> 프로젝트: my-claude-plugins

---

## 1. 현재 상태

### 작업 목표
EEXIST 버그(#27791)로 `/plugin update`가 동작하지 않는 상황에서, my-session-wrap 플러그인의 캐시 불일치 문제를 발견하고 해결하는 것.

### 진행 현황
- 캐시 불일치 발견 → 수동 동기화 워크플로우 확립 → 부수 이슈 3건 수정 → E2E 4차 테스트 완료

### 의사결정 로그
1. "독립 커맨드/스킬로 설치" 제안 → **기각** (과잉 대응, 훅 이식 불가, 이중 관리 부담)
2. "캐시 수동 동기화" 채택 → `git pull` + `cp -r` 워크플로우 확립
3. 부수 이슈 수정: 세션 ID 파일 기반 전환, `${baseDir}` 제거, `touch` 제거

---

## 2. 변경 내역

| 파일 | 변경 |
|------|------|
| `my-session-wrap/skills/my-session-wrap/SKILL.md` | `$CLAUDE_SESSION_ID` → `cat .claude/.current-session-id`, `${baseDir}/` → 상대 경로 |
| `my-session-wrap/skills/history-insight/SKILL.md` | `${baseDir}/` 4개소 제거 |
| `my-session-wrap/skills/session-analyzer/SKILL.md` | `${baseDir}/` 3개소 제거 |
| `my-session-wrap/skills/my-session-wrap/scripts/next-handoff.sh` | `touch "$NEW_FILE"` 제거 |
| `CHANGELOG.md` | 위 수정사항 2건 기록 추가 |

커밋: `5f7af59`, `438824c` + CHANGELOG 커밋 `7ce82da`, `4c43fc4`

---

## 3. 피드백 루프

### 잘된 점
- 사용자의 "정말 동작하고 있는가?" 질문이 버전 번호만 보고 오진한 것을 바로잡음
- `diff -r`로 3개 경로(캐시/마켓플레이스/개발레포)의 실질적 코드 차이 발견
- 4차에 걸친 E2E 테스트로 점진적으로 이슈 발견 및 해결

### 실수 → 교훈
- **버전 번호 일치 ≠ 코드 일치** — installed_plugins.json의 `2.0.0`만 보고 동기화 완료로 판단한 오진
- **플러그인 3단계 경로** (개발→마켓플레이스→캐시) 이해 필수, 특히 Claude Code는 캐시에서 로딩
- **Hook 환경변수 불가** — 자식 프로세스는 부모 환경변수를 수정할 수 없음 (OS 제약)
- **`${baseDir}`는 시스템 변수가 아님** — SKILL.md 내 bash 코드의 변수는 Claude가 추론으로 해석

---

## 4. 다음 세션 작업

### 나중
- [ ] EEXIST 해결 후 `/plugin update` 정상 동작 확인
- [ ] handoff 진단문서(`handoff_20260225_05`)에 캐시 불일치 발견 추가
- [ ] 스크립트 경로 이슈 — Claude Code에 `${SKILL_DIR}` 변수 요청 검토

### 참조 문서
- 상세 검토: `handoff/handoff_20260225_08_플러그인캐시-우회책검토.md`
- EEXIST 진단: `handoff/handoff_20260225_05_EEXIST버그-진단.md`
- 4차 E2E: `handoff/handoff_20260225_12_4차-e2e테스트-일반프로젝트.md`
- 테스트 워크플로우: `handoff_08` §5
