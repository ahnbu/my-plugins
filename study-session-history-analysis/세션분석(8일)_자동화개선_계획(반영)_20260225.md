# 세션 분석 기반 자동화 개선 계획

## Context

228개 세션(8일간) 분석 결과, **handoff 생산은 자동화(`/wrap`)되었지만 소비(재개)가 수동**인 것이 가장 큰 비효율. `/plugin` 90회 반복, Request interrupted 220회, 메타작업 70%+ 등의 패턴이 발견됨. 핵심 개선 포인트는 "handoff 생산-소비 사이클 완성"과 "반복 교훈의 규칙 승격 파이프라인".

---

## 변경 사항 (6개, 우선순위 순)

### 1. `/continue` 커맨드 신규 생성 [ROI: 최고]

> 최신 handoff를 자동으로 찾아 읽고 컨텍스트를 재수립하는 전용 커맨드

**파일:** `my-session-wrap/commands/continue.md` (신규)

- `handoff/handoff_*.md` Glob → 최신순 정렬
- 최신 1개 자동 선택 (당일 여러 개면 AskUserQuestion)
- Read 후 요약 출력: 작업 목표, 현재 상태, 시작점, 알려진 제약
- "위 컨텍스트로 시작할까요?" 확인
- frontmatter에 `plugin: my-session-wrap` 마커 포함

### 2. SessionStart hook — handoff 자동 감지 알림 [ROI: 높음]

> 세션 시작 시 24시간 이내 handoff가 있으면 `/continue` 안내

**파일:** `my-session-wrap/hooks/check-handoff.js` (신규), `hooks.json` (수정)

- stdin에서 `cwd` 읽기 → `handoff/` 폴더 탐색
- 최신 handoff의 mtime이 24시간 이내면 stdout에 안내 출력
- hooks.json의 SessionStart 배열에 항목 추가
- timeout: 3000ms, stdin 방어 (`if (!input) return` + try-catch)

### 3. `/wrap` 완료 시 재개 프롬프트 출력 [ROI: 높음]

> handoff 생성 후 다음 세션에서 붙여넣을 재개 프롬프트를 자동 출력

**파일:** `my-session-wrap/skills/my-session-wrap/SKILL.md` (수정)

- Step 3 이후에 "Step 4: 재개 안내" 추가
- 생성된 handoff 경로를 포함한 재개 프롬프트 출력
- 형식: `이전 세션에 이어서 작업합니다. /continue`

### 4. handoff 템플릿에 "환경 스냅샷" 섹션 추가 [ROI: 중간]

> 환경 이슈(EEXIST, MCP 실패 등)를 기록하여 다음 세션 반복 진단 방지

**파일:** `my-session-wrap/skills/my-session-wrap/references/template.md` (수정)

- §5 뒤에 `## 6. 환경 스냅샷` 추가
- 항목: 플러그인 상태, 알려진 제약, 워크어라운드
- "알려진 이슈가 있을 때만 포함" 조건 (SKILL.md에도 명시)

### 5. 글로벌 CLAUDE.md — handoff 재개 프로토콜 [ROI: 높음]

> "이어서/계속/지난 세션" 표현 시 자동으로 handoff를 읽는 규칙

**파일:** `~/.claude/CLAUDE.md` (수정)

- `## 비개발 작업` 섹션에 2줄 추가:
  - 사용자가 "이어서" 등의 표현 → `handoff/` 최신 파일 Read → 재개
  - handoff 기반 재개 시 파일·경로 실존 검증 필수

### 6. `/wrap` 피드백 루프 → 규칙 후보 마킹 [ROI: 중간]

> 2회+ 반복된 레슨에 `[규칙 후보]` 태그 → CLAUDE.md 반영 여부 질문

**파일:** `my-session-wrap/skills/my-session-wrap/SKILL.md` (수정)

- Step 2-3 "handoff 파일 작성" 부분에 규칙 후보 판정 로직 추가
- 2회 이상 반복 패턴이면 `[규칙 후보]` 태그
- 태그 1개 이상이면 AskUserQuestion으로 CLAUDE.md 반영 여부 확인

---

## 버전 관리

- `plugin.json`: 2.1.0 → 2.2.0 (minor: 새 커맨드 추가)
- `marketplace.json`: 동일하게 2.2.0으로 동기화
- CHANGELOG.md: 6개 변경사항 기록

---

## 수정하지 않는 것

- **A-2 `/plugin` 반복 방지 규칙**: 프로젝트 CLAUDE.md에 추가해봤자 사용자가 직접 `/plugin` 치는 것은 막을 수 없음. Hook 기반 헬스체크가 더 효과적이지만 구현 복잡도 높아 이번 스코프에서 제외.
- **C-3 doc-version 스킬**: 기존 글로벌 CLAUDE.md 규칙(`_v1` 리네임)으로 충분. 빈도가 낮아 ROI 부족.
- **실험 문서 네이밍 규칙**: 빈도가 낮아 CLAUDE.md 토큰 비용 대비 효과 미미.

---

## 검증 방법

1. **`/continue` 테스트**: `/wrap`으로 handoff 생성 → 새 세션에서 `/continue` 실행 → handoff 내용이 올바르게 요약되는지 확인
2. **hook 테스트**: 새 세션 시작 → check-handoff.js가 최신 handoff를 감지하여 안내 메시지 출력하는지 확인
3. **`/wrap` 재개 프롬프트**: `/wrap` 실행 → 마지막에 재개 프롬프트가 출력되는지 확인
4. **환경 스냅샷**: 환경 이슈가 있는 세션에서 `/wrap` → handoff에 §6이 포함되는지 확인
5. **규칙 후보 마킹**: 반복 교훈이 있는 세션에서 `/wrap` → `[규칙 후보]` 태그 + AskUserQuestion 호출 확인
6. **버전 검증**: pre-commit hook이 plugin.json ↔ marketplace.json 버전 일치를 통과하는지 확인
