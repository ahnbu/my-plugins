# í”ŒëŸ¬ê·¸ì¸ ì§„ë‹¨ ê²°ê³¼ ë° ì„¸ì…˜ ID í…ŒìŠ¤íŠ¸ 3ì°¨ ê³„íš

> ì‘ì„±ì¼: 2026-02-24
> ì´ì „ ë¬¸ì„œ: `ì„¸ì…˜idí™•ë³´_í…ŒìŠ¤íŠ¸2ì°¨_20260224.md`
> ëª©ì : plugin-dev ê¸°ë°˜ í”„ë¡œì íŠ¸ ì „ì²´ ì§„ë‹¨ + ì„¸ì…˜ ID ë¬¸ì œ ê·¼ë³¸ ì›ì¸ í™•ì • + Node.js ì „í™˜ í…ŒìŠ¤íŠ¸ ê³„íš

---

## 1. í”„ë¡œì íŠ¸ ì „ë°˜ ì§„ë‹¨

### êµ¬ì¡° ì¤€ìˆ˜: âœ… ì–‘í˜¸

3ê°œ í”ŒëŸ¬ê·¸ì¸ ëª¨ë‘ í‘œì¤€ êµ¬ì¡° ì¤€ìˆ˜:

| í•­ëª© | my-session-wrap | my-cowork | my-session-dashboard |
|------|:---:|:---:|:---:|
| `.claude-plugin/plugin.json` | âœ… | âœ… | âœ… |
| `hooks/hooks.json` | âœ… | âœ… | âœ… |
| `hooks/ensure-commands.js` | âœ… | âœ… | âœ… |
| `commands/*.md` (plugin ë§ˆì»¤) | âœ… | âœ… | âœ… |
| `agents/*.md` | âœ… (5ê°œ) | N/A | N/A |
| `skills/*/SKILL.md` | âœ… (3ê°œ) | âœ… (1ê°œ) | âœ… (1ê°œ) |

### ë°œê²¬ëœ ë¬¸ì œ (3ê±´)

| # | ì‹¬ê°ë„ | ë¬¸ì œ | ìœ„ì¹˜ |
|---|--------|------|------|
| 1 | ğŸ”´ Critical | **ì„¸ì…˜ ID ìº¡ì²˜ hook ë¯¸ë™ì‘** â€” Windowsì—ì„œ .sh ì‹¤í–‰ ë¶ˆê°€ | `my-session-wrap/hooks/capture-session-id.sh` |
| 2 | ğŸŸ¡ Medium | **ë²„ì „ ë¶ˆì¼ì¹˜** â€” plugin.json `1.1.3` vs marketplace.json `1.0.0` | `my-cowork` |
| 3 | ğŸŸ¡ Medium | **ë²„ì „ ë¶ˆì¼ì¹˜** â€” plugin.json `1.1.0` vs marketplace.json `1.0.1` | `my-session-wrap` |

---

## 2. ì„¸ì…˜ ID ë¬¸ì œ â€” ê·¼ë³¸ ì›ì¸ í™•ì •

### ê²°ë¡ : ê°€ì„¤ 6 í™•ì • â€” Windowsì—ì„œ bash ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ë¶ˆê°€

2ì°¨ í…ŒìŠ¤íŠ¸ì—ì„œ ê°€ì„¤ 1~5ë¥¼ ì²´ê³„ì ìœ¼ë¡œ ê¸°ê°í•˜ê³ , ê°€ì„¤ 6ë§Œ ë¯¸ê²€ì¦ ìƒíƒœë¡œ ë‚¨ì•˜ë‹¤.
ì¶”ê°€ ë¶„ì„ì„ í†µí•´ ê°€ì„¤ 6ì´ ê·¼ë³¸ ì›ì¸ì„ì„ í™•ì •í•œë‹¤.

### ê²°ì •ì  ì¦ê±°

| êµ¬ë¶„ | ìŠ¤í¬ë¦½íŠ¸ | hook ì´ë²¤íŠ¸ | ì‹¤í–‰ ê²°ê³¼ |
|------|----------|-------------|-----------|
| `ensure-commands.js` | Node.js | SessionStart | âœ… ì •ìƒ ë™ì‘ |
| `capture-session-id.sh` | Bash | UserPromptSubmit | âŒ ì™„ì „ ì‹¤íŒ¨ |

- ê°™ì€ hooks.jsonì—ì„œ ê°™ì€ `${CLAUDE_PLUGIN_ROOT}` ë³€ìˆ˜ë¥¼ ì‚¬ìš©
- `node "..."` í˜•ì‹ì€ ë™ì‘, `.sh` ë° `bash "..."` í˜•ì‹ì€ ëª¨ë‘ ì‹¤íŒ¨
- ìŠ¤í¬ë¦½íŠ¸ ì²« ì¤„ì— ë¬´ì¡°ê±´ ì‹¤í–‰ êµ¬ë¬¸(`echo > ~/debug.txt`)ì„ ë„£ì–´ë„ íŒŒì¼ ë¯¸ìƒì„±
  â†’ **bash í”„ë¡œì„¸ìŠ¤ ìì²´ê°€ forkë˜ì§€ ì•ŠìŒ**

### ê·¼ë³¸ ì›ì¸ ë©”ì»¤ë‹ˆì¦˜

```
Claude Code hook ì‹¤í–‰ê¸°
  â””â”€ child_process.exec(command)
       â””â”€ Windows ê¸°ë³¸ shell: cmd.exe
            â”œâ”€ "node ..." â†’ node.exeëŠ” Windows PATHì— ìˆìŒ â†’ âœ… ì‹¤í–‰
            â”œâ”€ "bash ..." â†’ bashëŠ” MSYS/Git Bash PATHì—ë§Œ ìˆìŒ â†’ âŒ ì‹¤íŒ¨
            â””â”€ "./script.sh" â†’ shebang í•´ì„ ë¶ˆê°€ â†’ âŒ ì‹¤íŒ¨
```

cmd.exeëŠ”:
- `.sh` íŒŒì¼ì˜ shebang(`#!/bin/bash`)ì„ í•´ì„í•˜ì§€ ëª»í•¨
- `bash` ëª…ë ¹ì–´ë¥¼ ì°¾ì§€ ëª»í•¨ (MSYS/Git Bash PATHê°€ cmd.exe í™˜ê²½ì—ëŠ” í¬í•¨ë˜ì§€ ì•ŠìŒ)
- ë°˜ë©´ `node`ëŠ” Windows ë„¤ì´í‹°ë¸Œ ì„¤ì¹˜ë¡œ ì–´ë””ì„œë“  ì‹¤í–‰ ê°€ëŠ¥

---

## 3. í•´ê²° ê³„íš: Node.js ì „í™˜

### 3-1. capture-session-id.js ì‹ ê·œ ìƒì„±

`my-session-wrap/hooks/capture-session-id.js`:

```js
#!/usr/bin/env node
const fs = require("fs");
const path = require("path");

let input = "";
process.stdin.on("data", (chunk) => { input += chunk; });
process.stdin.on("end", () => {
  try {
    const data = JSON.parse(input);
    const sessionId = data.session_id;
    const cwd = data.cwd;
    if (sessionId && cwd) {
      const dir = path.join(cwd, ".claude");
      fs.mkdirSync(dir, { recursive: true });
      fs.writeFileSync(path.join(dir, ".current-session-id"), sessionId);
    }
  } catch (e) {
    // hook ì‹¤íŒ¨ê°€ ì„¸ì…˜ì— ì˜í–¥ ì£¼ì§€ ì•Šë„ë¡ ë¬´ì‹œ
  }
});
```

**ì„¤ê³„ í¬ì¸íŠ¸:**
- ensure-commands.jsì™€ ë™ì¼í•œ íŒ¨í„´ (ì´ë¯¸ ì •ìƒ ë™ì‘ ê²€ì¦ë¨)
- jq ì˜ì¡´ì„± ì œê±° (Node.js ë‚´ì¥ `JSON.parse` ì‚¬ìš©)
- stdin stream â†’ JSON íŒŒì‹± â†’ íŒŒì¼ ì €ì¥

### 3-2. hooks.json ìˆ˜ì •

```diff
- "command": "${CLAUDE_PLUGIN_ROOT}/hooks/capture-session-id.sh"
+ "command": "node \"${CLAUDE_PLUGIN_ROOT}/hooks/capture-session-id.js\""
```

### 3-3. capture-session-id.sh ì‚­ì œ

ë””ë²„ê·¸ ì½”ë“œê°€ ë‚¨ì•„ìˆëŠ” .sh íŒŒì¼ì€ ë” ì´ìƒ í•„ìš” ì—†ìœ¼ë¯€ë¡œ ì‚­ì œ.

### 3-4. ë²„ì „ ë¶ˆì¼ì¹˜ ìˆ˜ì •

marketplace.json ì—…ë°ì´íŠ¸:
- `my-session-wrap`: `1.0.1` â†’ `1.1.0`
- `my-cowork`: `1.0.0` â†’ `1.1.3`

---

## 4. ê²€ì¦ ê³„íš

### 4-1. ë””ë²„ê·¸ ëª¨ë“œ í…ŒìŠ¤íŠ¸ (1ì°¨)

capture-session-id.jsì— ì„ì‹œ ë””ë²„ê·¸ ì½”ë“œ ì¶”ê°€:

```js
// ë””ë²„ê·¸: stdin ì „ì²´ ë¤í”„
const home = process.env.HOME || process.env.USERPROFILE;
fs.writeFileSync(path.join(home, "hook-debug-stdin.json"), input);
fs.writeFileSync(path.join(home, "hook-debug-cwd.txt"),
  `stdin.cwd=${data.cwd}\nprocess.cwd()=${process.cwd()}`);
```

**í™•ì¸ í•­ëª©:**
1. `~/hook-debug-stdin.json` íŒŒì¼ ìƒì„± ì—¬ë¶€ â†’ Node.js ì‹¤í–‰ ìì²´ ê²€ì¦
2. stdin JSONì— `session_id`, `cwd` í•„ë“œ ì¡´ì¬ ì—¬ë¶€
3. `process.cwd()`ì™€ stdin `cwd`ì˜ ì°¨ì´ í™•ì¸

### 4-2. ë³¸ í…ŒìŠ¤íŠ¸ (2ì°¨)

ë””ë²„ê·¸ ì½”ë“œ ì œê±° í›„:
1. `git push` â†’ `/plugin update`
2. ìƒˆ ì„¸ì…˜ ì‹œì‘ â†’ í”„ë¡¬í”„íŠ¸ ì…ë ¥
3. `<cwd>/.claude/.current-session-id` íŒŒì¼ ìƒì„± í™•ì¸
   - `cwd`ëŠ” hook stdin JSONì˜ `cwd` í•„ë“œ ê°’ (= Claude Codeê°€ ì—´ë¦° í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬)
4. íŒŒì¼ ë‚´ìš©ì´ ìœ íš¨í•œ session IDì¸ì§€ í™•ì¸

---

## 5. íƒ€ì„ë¼ì¸

| ì‹œì  | ì‘ì—… | ìƒíƒœ |
|------|------|------|
| 2ì°¨ í…ŒìŠ¤íŠ¸ | ê°€ì„¤ 1~5 ê¸°ê°, ê°€ì„¤ 6 ë¯¸ê²€ì¦ | ì™„ë£Œ |
| 3ì°¨ ì§„ë‹¨ | ê°€ì„¤ 6 ê·¼ë³¸ ì›ì¸ í™•ì • (ì¦ê±° ê¸°ë°˜) | **ì™„ë£Œ** |
| ë‹¤ìŒ | capture-session-id.js ìƒì„± + hooks.json ìˆ˜ì • | ëŒ€ê¸° |
| ë‹¤ìŒ | ë””ë²„ê·¸ ëª¨ë“œ 1ì°¨ í…ŒìŠ¤íŠ¸ | ëŒ€ê¸° |
| ë‹¤ìŒ | ë””ë²„ê·¸ ì œê±° + ë³¸ í…ŒìŠ¤íŠ¸ | ëŒ€ê¸° |

---

## 6. êµí›ˆ (2ì°¨ì—ì„œ ì´ì–´ì§)

1. **Windows í¬ë¡œìŠ¤ í”Œë«í¼ hookì€ Node.jsë¡œ ì‘ì„±**: bash/shebang ê¸°ë°˜ì€ Windows cmd.exeì—ì„œ ë™ì‘í•˜ì§€ ì•ŠìŒ.
2. **ê°™ì€ hooks.json ë‚´ ë™ì‘/ë¹„ë™ì‘ ë¹„êµê°€ ê°€ì¥ ê°•ë ¥í•œ ì§„ë‹¨ ë„êµ¬**: ensure-commands.js(node) vs capture-session-id.sh(bash)ì˜ ëŒ€ì¡°ê°€ ê·¼ë³¸ ì›ì¸ì„ íŠ¹ì •.
3. **"hook success" â‰  command ì‹¤í–‰**: Claude Codeì˜ hook success ë©”ì‹œì§€ëŠ” ì´ë²¤íŠ¸ ì²˜ë¦¬ë¥¼ ì˜ë¯¸í•˜ë©°, command í”„ë¡œì„¸ìŠ¤ì˜ ì‹¤ì œ ì‹¤í–‰ê³¼ëŠ” ë³„ê°œ.
