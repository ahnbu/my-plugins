# 플러그인 에러 대처

> 환경: Windows (MSYS2 bash), Claude Code Standalone binary
> 최초 작성: 2026-02-26

---

## 1. EEXIST 버그 — `/plugin update` 및 UI 설치 실패

### 증상

```
EEXIST: file already exists, mkdir 'C:\Users\ahnbu\.claude\plugins'
EEXIST: file already exists, mkdir 'C:\Users\ahnbu\.claude\plugins\marketplaces'
Failed to refresh marketplace '...' : EEXIST: ...
```

### 원인

Claude Code 내부 `fs.mkdir()` 호출 시 `{ recursive: true }` 옵션 누락.
이미 존재하는 디렉토리에 mkdir 시도 → EEXIST throw.
GitHub 이슈: [#27791](https://github.com/anthropics/claude-code/issues/27791)

### 워크어라운드 A — 기존 플러그인 업데이트 (코드 변경 후 캐시 반영)

```bash
# 1. 개발 레포 push
git push

# 2. 마켓플레이스 클론 pull
cd ~/.claude/plugins/marketplaces/my-claude-plugins && git pull

# 3. 캐시에 복사 (/* 대신 /. — 숨김 디렉토리 포함)
cp -r ~/.claude/plugins/marketplaces/my-claude-plugins/<plugin-name>/. \
      ~/.claude/plugins/cache/my-claude-plugins/<plugin-name>/<version>/

# 4. installed_plugins.json의 version, installPath, gitCommitSha 업데이트

# 5. diff 검증
diff -r ~/.claude/plugins/marketplaces/my-claude-plugins/<plugin-name>/ \
        ~/.claude/plugins/cache/my-claude-plugins/<plugin-name>/<version>/
```

### 워크어라운드 B — 신규 플러그인 설치 (미설치 플러그인)

```bash
# 1. 마켓플레이스 클론 pull
cd ~/.claude/plugins/marketplaces/my-claude-plugins && git pull

# 2. 버전 확인 및 캐시 디렉토리 생성
VERSION=$(cat ~/.claude/plugins/marketplaces/my-claude-plugins/<plugin-name>/.claude-plugin/plugin.json \
  | python3 -c "import sys,json; print(json.load(sys.stdin)['version'])")
mkdir -p ~/.claude/plugins/cache/my-claude-plugins/<plugin-name>/$VERSION

# 3. 파일 복사 (.claude-plugin/ 숨김 폴더 포함)
cp -r ~/.claude/plugins/marketplaces/my-claude-plugins/<plugin-name>/. \
      ~/.claude/plugins/cache/my-claude-plugins/<plugin-name>/$VERSION/

# 4. diff 검증
diff -r ~/.claude/plugins/marketplaces/my-claude-plugins/<plugin-name>/ \
        ~/.claude/plugins/cache/my-claude-plugins/<plugin-name>/$VERSION/
```

**수동 편집 파일 2개**:

| 파일 | 수정 내용 |
|------|-----------|
| `~/.claude/plugins/installed_plugins.json` | 신규 항목 추가: scope, installPath, version, installedAt, lastUpdated, gitCommitSha |
| `~/.claude/settings.json` → `enabledPlugins` | `"<plugin-name>@my-claude-plugins": true` 추가 |

`gitCommitSha` 확인:
```bash
cd ~/.claude/plugins/marketplaces/my-claude-plugins && git rev-parse HEAD
```

### 버그 픽스 후

EEXIST 수정 확인 시:
1. 이 문서의 워크어라운드는 참고용으로 보존
2. CLAUDE.md의 "EEXIST 버그 워크어라운드" 섹션 삭제
3. 이후에는 `/plugin update` 및 UI 설치 정상 사용

---

## 2. 새 세션 없이 변경사항 미반영

### 증상

캐시 동기화 후에도 hooks/skills/commands가 반영되지 않음.

### 원인

Claude Code는 세션 시작 시점에 플러그인을 로드. 세션 중 `installed_plugins.json` 변경은 현재 세션에 미반영.

### 대처

캐시 동기화 완료 후 반드시 새 세션을 열어서 확인.
